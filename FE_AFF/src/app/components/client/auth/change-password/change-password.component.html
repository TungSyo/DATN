<p-toast />
<form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()">
    <p-toast></p-toast>

    <div class="flex flex-column align-items-center justify-content-center">
        <div
            style="
                border-radius: 56px;
                padding: 0.3rem;
                background: linear-gradient(
                    180deg,
                    #199807 10%,
                    rgb(38 244 67 / 0%) 30%
                );
            "
        >
            <div
                class="w-full surface-card py-8 px-5 sm:px-8"
                style="border-radius: 53px"
            >
                <div class="text-center mb-5">
                    <img
                        src="assets/image/logo/logo-honivy.jpg"
                        alt="Image"
                        width="100"
                        height="100"
                        class="mb-3"
                    />
                    <div class="text-600 text-2xl font-medium mb-3">
                        Đổi mật khẩu mới
                    </div>
                </div>

                <p-messages [(value)]="messages"></p-messages>

                <!-- Nội dung form đổi mật khẩu -->
                <div>
                    <div class="mb-4">
                        <div class="field-group user_name">
                            <div class="password-wrapper">
                                <input
                                    id="oldPassword"
                                    [type]="showPassword ? 'text' : 'password'"
                                    spellcheck="false"
                                    class="md:w-30rem input user_name"
                                    placeholder="Mật khẩu cũ"
                                    formControlName="oldPassword"
                                />
                                <button
                                    type="button"
                                    class="toggle-password"
                                    (click)="showPassword = !showPassword"
                                >
                                    <i
                                        [class]="
                                            showPassword
                                                ? 'fa fa-eye-slash'
                                                : 'fa fa-eye'
                                        "
                                    ></i>
                                </button>
                            </div>

                            <div
                                *ngIf="
                                    changePasswordForm.get('oldPassword')
                                        ?.invalid &&
                                    (changePasswordForm.get('oldPassword')
                                        ?.dirty ||
                                        changePasswordForm.get('oldPassword')
                                            ?.touched)
                                "
                            >
                                <div
                                    *ngIf="changePasswordForm.get('oldPassword')?.errors?.['required']"
                                    class="error-message"
                                >
                                    Vui lòng nhập mật khẩu cũ
                                </div>
                                <div
                                    *ngIf="
                                        changePasswordForm
                                            .get('oldPassword')
                                            ?.hasError('whitespace') &&
                                        (changePasswordForm.get('oldPassword')
                                            ?.dirty ||
                                            changePasswordForm.get(
                                                'oldPassword'
                                            )?.touched)
                                    "
                                >
                                    <small class="text-danger"
                                        >Mật khẩu không được chứa khoảng
                                        trắng.</small
                                    >
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <div class="field-group user_name">
                            <div class="password-wrapper">
                                <input
                                    id="newPassword"
                                    [type]="
                                        showPasswordConfim ? 'text' : 'password'
                                    "
                                    spellcheck="false"
                                    class="md:w-30rem input user_name"
                                    placeholder="Nhập mật khẩu mới"
                                    formControlName="newPassword"
                                />
                                <button
                                    type="button"
                                    class="toggle-password"
                                    (click)="
                                        showPasswordConfim = !showPasswordConfim
                                    "
                                >
                                    <i
                                        [class]="
                                            showPasswordConfim
                                                ? 'fa fa-eye-slash'
                                                : 'fa fa-eye'
                                        "
                                    ></i>
                                </button>
                            </div>

                            <div
                                *ngIf="
                                    changePasswordForm
                                        .get('newPassword')
                                        ?.hasError('whitespace')
                                "
                            >
                                <small class="text-danger"
                                    >Mật khẩu không được chứa khoảng
                                    trắng.</small
                                >
                            </div>

                            <div
                                *ngIf="
                                    changePasswordForm.get('newPassword')
                                        ?.invalid &&
                                    (changePasswordForm.get('newPassword')
                                        ?.dirty ||
                                        changePasswordForm.get('newPassword')
                                            ?.touched)
                                "
                            >
                                <div
                                    *ngIf="changePasswordForm.get('newPassword')?.errors?.['required']"
                                    class="error-message"
                                >
                                    Vui lòng nhập mật khẩu mới
                                </div>
                            </div>

                            <p *ngIf="errorMessages" class="error-message">
                                Mật khẩu mới không được trùng với mật khẩu cũ.
                            </p>
                        </div>
                    </div>

                    <button
                        *ngIf="!otpSent"
                        style="background-color: #4d8526; margin-top: 10px"
                        pButton
                        pRipple
                        label="XÁC NHẬN"
                        class="w-full p-3 text-xl"
                        type="submit"
                    ></button>

                    <button
                        *ngIf="otpSent"
                        style="background-color: #4d8526"
                        pButton
                        pRipple
                        label="Quay lại trang đăng nhập"
                        class="w-full p-3 text-xl"
                        type="button"
                        (click)="navigateToSetPassword()"
                    ></button>
                </div>
            </div>
        </div>
    </div>
</form>
