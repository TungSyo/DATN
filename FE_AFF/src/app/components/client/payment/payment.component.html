<p-toast />
<div class="payment">
    <div class="container">
        <div class="payment-inner">
            <div class="payment-title">
                <h1>Thanh toán</h1>
            </div>
            <div class="payment__coupon">
                <div class="payment__coupon-desc">
                    <p>Bạn có mã ưu đãi?<span>Ấn vào đây để nhập mã</span></p>
                </div>
                <div class="payment__coupon-search">
                    <label
                        >Nếu bạn có mã giảm giá, vui lòng điền vào phía bên
                        dưới.</label
                    >
                    <div class="payment__coupon-search-box">
                        <span>
                            <svg
                                stroke="currentColor"
                                fill="currentColor"
                                viewBox="0 0 24 24"
                                height="1em"
                                width="1em"
                                xmlns="http://www.w3.org/2000/svg"
                            >
                                <path
                                    d="M10.0049 20.9997H3.00488C2.4526 20.9997 2.00488 20.5519 2.00488 19.9997V3.99966C2.00488 3.44738 2.4526 2.99966 3.00488 2.99966H10.0049C10.0049 4.10423 10.9003 4.99966 12.0049 4.99966C13.1095 4.99966 14.0049 4.10423 14.0049 2.99966H21.0049C21.5572 2.99966 22.0049 3.44738 22.0049 3.99966V19.9997C22.0049 20.5519 21.5572 20.9997 21.0049 20.9997H14.0049C14.0049 19.8951 13.1095 18.9997 12.0049 18.9997C10.9003 18.9997 10.0049 19.8951 10.0049 20.9997ZM6.00488 7.99966V15.9997H8.00488V7.99966H6.00488ZM16.0049 7.99966V15.9997H18.0049V7.99966H16.0049Z"
                                ></path>
                            </svg>
                        </span>
                        <input
                            class="payment__coupon-search-input"
                            placeholder="Nhập mã ưu đãi"
                            [(ngModel)]="codeVoucherSelected"
                        />
                        <button
                            class="payment__coupon-search-btn"
                            (click)="handleSelectVoucher()"
                        >
                            ÁP DỤNG
                        </button>
                        <p class="error-message">{{ errorMessageVoucher }}</p>
                    </div>
                </div>
            </div>
            <form [formGroup]="orderForm" (ngSubmit)="onSubmit()">
                <div class="payment__content">
                    <div class="payment__info">
                        <div class="coupon-list" *ngIf="listVoucher.length > 0">
                            <div
                                *ngFor="let voucher of listVoucher"
                                class="coupon-item flex flex-column"
                            >
                                <span>Mã giảm giá: {{ voucher?.code }}</span>
                                <span
                                    >Trị giá:
                                    {{ voucher?.voucherAmount }} đ</span
                                >
                                <span (click)="removeVoucher(i)">Xóa</span>
                            </div>
                        </div>
                        <div>
                            <div class="register-header">
                                <h1 class="register-title">
                                    Thông tin thanh toán
                                </h1>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-4 px-3">
                                    <div class="field-group user_name">
                                        <input
                                            id="user"
                                            class="input"
                                            type="text"
                                            spellcheck="false"
                                            placeholder="Tên người dùng"
                                            formControlName="name"
                                        />
                                        <div
                                            *ngIf="
                                                orderForm.get('name')
                                                    ?.invalid &&
                                                (orderForm.get('name')?.dirty ||
                                                    orderForm.get('name')
                                                        ?.touched)
                                            "
                                        >
                                            <div
                                                *ngIf="orderForm.get('name')?.errors?.['required']"
                                                class="error-message"
                                            >
                                                Vui lòng nhập tên
                                            </div>
                                            <div
                                                *ngIf="!orderForm.get('name')?.errors?.['required'] &&
                orderForm.get('name')?.errors?.['whitespace']"
                                                class="error-message"
                                            >
                                                Tên không được chứa khoảng trắng
                                            </div>
                                        </div>

                                        <span>
                                            <svg
                                                stroke="currentColor"
                                                fill="currentColor"
                                                stroke-width="0"
                                                viewBox="0 0 512 512"
                                                height="1em"
                                                width="1em"
                                                xmlns="http://www.w3.org/2000/svg"
                                            >
                                                <path
                                                    d="M256 256a112 112 0 1 0-112-112 112 112 0 0 0 112 112zm0 32c-69.42 0-208 42.88-208 128v64h416v-64c0-85.12-138.58-128-208-128z"
                                                ></path>
                                            </svg>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-4 px-3">
                                    <div class="field-group">
                                        <input
                                            id="user"
                                            type="text"
                                            spellcheck="false"
                                            class="input user_name"
                                            placeholder="Số điện thoại"
                                            formControlName="phoneNumber"
                                        />
                                        <div
                                            *ngIf="
                                                orderForm.get('phoneNumber')
                                                    ?.invalid &&
                                                (orderForm.get('phoneNumber')
                                                    ?.dirty ||
                                                    orderForm.get('phoneNumber')
                                                        ?.touched)
                                            "
                                        >
                                            <div
                                                *ngIf="orderForm.get('phoneNumber')?.errors?.['required']"
                                                class="error-message"
                                            >
                                                Vui lòng nhập số điện thoại
                                            </div>
                                            <div
                                                *ngIf="!orderForm.get('phoneNumber')?.errors?.['required'] &&
                                    orderForm.get('phoneNumber')?.errors?.['whitespace']"
                                                class="error-message"
                                            >
                                                SĐT không được chứa khoảng trắng
                                            </div>
                                        </div>

                                        <span>
                                            <svg
                                                stroke="currentColor"
                                                fill="currentColor"
                                                stroke-width="0"
                                                viewBox="0 0 512 512"
                                                height="1em"
                                                width="1em"
                                                xmlns="http://www.w3.org/2000/svg"
                                            >
                                                <path
                                                    d="M497.39 361.8l-112-48a24 24 0 0 0-28 6.9l-49.6 60.6A370.66 370.66 0 0 1 130.6 204.11l60.6-49.6a23.94 23.94 0 0 0 6.9-28l-48-112A24.16 24.16 0 0 0 122.6.61l-104 24A24 24 0 0 0 0 48c0 256.5 207.9 464 464 464a24 24 0 0 0 23.4-18.6l24-104a24.29 24.29 0 0 0-14.01-27.6z"
                                                ></path>
                                            </svg>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-4 px-3">
                                    <div class="field-group city-address">
                                        <input
                                            id="user"
                                            type="text"
                                            spellcheck="false"
                                            class="input city"
                                            placeholder="Chọn tỉnh"
                                            formControlName="cityName"
                                            (click)="isDropdownCity = true"
                                            (input)="
                                                searchCity($event.target.value)
                                            "
                                        />
                                        <span>
                                            <svg
                                                stroke="currentColor"
                                                fill="currentColor"
                                                stroke-width="0"
                                                viewBox="0 0 384 512"
                                                height="1em"
                                                width="1em"
                                                xmlns="http://www.w3.org/2000/svg"
                                            >
                                                <path
                                                    d="M215.7 499.2C267 435 384 279.4 384 192C384 86 298 0 192 0S0 86 0 192c0 87.4 117 243 168.3 307.2c12.3 15.3 35.1 15.3 47.4 0zM192 128a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"
                                                ></path>
                                            </svg>
                                        </span>
                                        <ul
                                            class="dropdown-list"
                                            *ngIf="isDropdownCity"
                                        >
                                            <li
                                                *ngFor="
                                                    let city of filteredCities
                                                "
                                                class="dropdown-item"
                                                (click)="
                                                    handleSelectCity(
                                                        city,
                                                        $event
                                                    )
                                                "
                                            >
                                                {{ city.name }}
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-4 px-3">
                                    <div class="field-group district-address">
                                        <input
                                            id="user"
                                            type="text"
                                            spellcheck="false"
                                            class="input district"
                                            placeholder="Chọn huyện"
                                            formControlName="districtName"
                                            (click)="isDropdownDistrict = true"
                                            (input)="
                                                searchDistrict(
                                                    $event.target.value
                                                )
                                            "
                                        />
                                        <span>
                                            <svg
                                                stroke="currentColor"
                                                fill="currentColor"
                                                stroke-width="0"
                                                viewBox="0 0 384 512"
                                                height="1em"
                                                width="1em"
                                                xmlns="http://www.w3.org/2000/svg"
                                            >
                                                <path
                                                    d="M215.7 499.2C267 435 384 279.4 384 192C384 86 298 0 192 0S0 86 0 192c0 87.4 117 243 168.3 307.2c12.3 15.3 35.1 15.3 47.4 0zM192 128a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"
                                                ></path>
                                            </svg>
                                        </span>
                                        <ul
                                            class="dropdown-list"
                                            *ngIf="isDropdownDistrict"
                                        >
                                            <li
                                                *ngIf="districts.length === 0"
                                                class="dropdown-item"
                                            >
                                                Vui lòng chọn tỉnh
                                            </li>
                                            <ng-container
                                                *ngIf="districts.length > 0"
                                            >
                                                <li
                                                    *ngFor="
                                                        let city of filteredDistricts
                                                    "
                                                    class="dropdown-item"
                                                    (click)="
                                                        handleSelectDistrict(
                                                            city,
                                                            $event
                                                        )
                                                    "
                                                >
                                                    {{ city.name }}
                                                </li>
                                            </ng-container>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-4 px-3">
                                    <div class="field-group ward-address">
                                        <input
                                            id="user"
                                            type="text"
                                            spellcheck="false"
                                            class="input ward"
                                            placeholder="Chọn xã"
                                            formControlName="wardName"
                                            (click)="isDropdownWard = true"
                                            (input)="
                                                searchWard($event.target.value)
                                            "
                                        />
                                        <span>
                                            <svg
                                                stroke="currentColor"
                                                fill="currentColor"
                                                stroke-width="0"
                                                viewBox="0 0 384 512"
                                                height="1em"
                                                width="1em"
                                                xmlns="http://www.w3.org/2000/svg"
                                            >
                                                <path
                                                    d="M215.7 499.2C267 435 384 279.4 384 192C384 86 298 0 192 0S0 86 0 192c0 87.4 117 243 168.3 307.2c12.3 15.3 35.1 15.3 47.4 0zM192 128a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"
                                                ></path>
                                            </svg>
                                        </span>

                                        <ul
                                            class="dropdown-list"
                                            *ngIf="isDropdownWard"
                                        >
                                            <li
                                                *ngIf="wards.length === 0"
                                                class="dropdown-item"
                                            >
                                                Vui lòng chọn tỉnh, huyện
                                            </li>
                                            <ng-container
                                                *ngIf="wards.length > 0"
                                            >
                                                <li
                                                    *ngFor="
                                                        let city of filteredWards
                                                    "
                                                    class="dropdown-item"
                                                    (click)="
                                                        handleSelectWard(
                                                            city,
                                                            $event
                                                        )
                                                    "
                                                >
                                                    {{ city.name }}
                                                </li>
                                            </ng-container>
                                        </ul>

                                        <!-- <ul class="dropdown-list" *ngIf="isDropdownWard">
                                <li
                                    *ngFor="let city of wards"
                                    class="dropdown-item"
                                    (click)="handleSelectWard(city, $event)"
                                >
                                    {{ city.name }}
                                </li>
                            </ul> -->
                                    </div>
                                </div>
                                <div class="col-md-6 mb-4 px-3">
                                    <div class="field-group user_name">
                                        <input
                                            id="user"
                                            class="input"
                                            type="text"
                                            spellcheck="false"
                                            placeholder="Địa chỉ chi tiết"
                                            formControlName="address"
                                        />
                                        <span>
                                            <svg
                                                stroke="currentColor"
                                                fill="currentColor"
                                                stroke-width="0"
                                                viewBox="0 0 384 512"
                                                height="1em"
                                                width="1em"
                                                xmlns="http://www.w3.org/2000/svg"
                                            >
                                                <path
                                                    d="M215.7 499.2C267 435 384 279.4 384 192C384 86 298 0 192 0S0 86 0 192c0 87.4 117 243 168.3 307.2c12.3 15.3 35.1 15.3 47.4 0zM192 128a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"
                                                ></path>
                                            </svg>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-4 px-3">
                                    <div class="field-group bank-inner">
                                        <input
                                            id="user"
                                            type="text"
                                            spellcheck="false"
                                            class="input bank"
                                            placeholder="Chọn ngân hàng"
                                            formControlName="paymentAccountReceiptName"
                                            (click)="isDropdownBank = true"
                                        />
                                        <div
                                            *ngIf="
                                                orderForm.get(
                                                    'paymentAccountReceiptName'
                                                )?.invalid &&
                                                (orderForm.get(
                                                    'paymentAccountReceiptName'
                                                )?.dirty ||
                                                    orderForm.get(
                                                        'paymentAccountReceiptName'
                                                    )?.touched)
                                            "
                                        >
                                            <div
                                                *ngIf="orderForm.get('paymentAccountReceiptName')?.errors?.['required']"
                                                class="error-message"
                                            >
                                                Vui lòng chọn tài khoản
                                            </div>
                                        </div>
                                        <span>
                                            <svg
                                                stroke="currentColor"
                                                fill="currentColor"
                                                stroke-width="0"
                                                viewBox="0 0 24 24"
                                                height="1em"
                                                width="1em"
                                                xmlns="http://www.w3.org/2000/svg"
                                            >
                                                <path
                                                    d="M2 8v4.001h1V18H2v3h16l3 .001V21h1v-3h-1v-5.999h1V8L12 2 2 8zm4 10v-5.999h2V18H6zm5 0v-5.999h2V18h-2zm7 0h-2v-5.999h2V18zM14 8a2 2 0 1 1-4.001-.001A2 2 0 0 1 14 8z"
                                                ></path>
                                            </svg>
                                        </span>
                                        <ul
                                            class="dropdown-list"
                                            *ngIf="isDropdownBank"
                                        >
                                            <li
                                                *ngFor="let city of banks"
                                                class="dropdown-item"
                                                (click)="
                                                    handleSelectBank(
                                                        city,
                                                        $event
                                                    )
                                                "
                                            >
                                                {{ city.bankCode }} -
                                                {{ city.accountNumber }} (
                                                {{ city.accountName }} )
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div class="register-header">
                                <h1 class="register-title">
                                    Phương thức thanh toán
                                </h1>
                            </div>
                            <div class="row">
                                <div class="col-md-4 mb-4 px-3">
                                    <div class="field-group-radio user_name">
                                        <input
                                            type="radio"
                                            formControlName="paymentMethod"
                                            [value]="0"
                                        />
                                        <label>Tài khoản ngân hàng</label>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-4 px-3">
                                    <div class="field-group-radio user_name">
                                        <input
                                            type="radio"
                                            formControlName="paymentMethod"
                                            [value]="1"
                                        />
                                        <label>Điểm trực tiếp</label>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-4 px-3">
                                    <div class="field-group-radio user_name">
                                        <input
                                            type="radio"
                                            formControlName="paymentMethod"
                                            [value]="2"
                                        />
                                        <label>Điểm gián tiếp</label>
                                    </div>
                                </div>
                                <!-- <div class="col-md-4 mb-4 px-3">
                                    <div class="field-group-radio user_name">
                                        <input
                                            type="radio"
                                            formControlName="paymentMethod"
                                            [value]="3"
                                        />
                                        <label
                                            >50% trực tiếp, 50% gián tiếp</label
                                        >
                                    </div>
                                </div> -->
                            </div>
                        </div>
                        <div>
                            <div class="register-header">
                                <h1 class="register-title">
                                    Thông tin bổ sung
                                </h1>
                            </div>
                            <div class="row">
                                <div class="col-md-12 mb-4 px-3">
                                    <div class="field-group user_name">
                                        <textarea
                                            class="note-textarea"
                                            formControlName="note"
                                            spellcheck="false"
                                            placeholder="Ghi chú về đơn hàng, ví dụ: thời gian hay chỉ dẫn địa điểm giao hàng chi tiết hơn."
                                        ></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="row px-3">
                                <!-- <button
                                    [disabled]="isSubmitting"
                                    class="button-submit"
                                    type="submit"
                                >
                                    {{ isSubmittingText }}
                                </button>
                                <div class="login-bottom">
                                    <span
                                        (click)="
                                            handleRedirectRegisterToLogin()
                                        "
                                        >Đăng nhập</span
                                    >
                                </div> -->
                            </div>
                        </div>
                    </div>
                    <div class="payment__sidebar">
                        <div class="register-header">
                            <h1 class="register-title">ĐƠN HÀNG CỦA BẠN</h1>
                            <table class="checkout-review-order-table">
                                <thead>
                                    <tr>
                                        <th class="product-name">Sản phẩm</th>
                                        <th
                                            class="product-total"
                                            style="text-align: right"
                                        >
                                            Tạm tính
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr
                                        class="cart_item"
                                        *ngFor="let item of cartItems"
                                    >
                                        <td class="product-name">
                                            {{ item.productName }}
                                            <strong class="product-quantity"
                                                >×&nbsp;{{
                                                    item.quantity
                                                }}</strong
                                            >
                                        </td>
                                        <td
                                            class="product-total"
                                            style="text-align: right"
                                        >
                                            <span class="price-amount amount">
                                                <bdi
                                                    >{{
                                                        item.price *
                                                            item.quantity
                                                            | number : "1.0-0"
                                                    }}
                                                    <span
                                                        class="woocommerce-Price-currency-symbol"
                                                        >đ</span
                                                    >
                                                </bdi>
                                            </span>
                                        </td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr class="cart-subtotal">
                                        <th>Tạm tính</th>
                                        <td style="text-align: right">
                                            <span class="price-amount amount">
                                                <bdi
                                                    >{{
                                                        totalAmount
                                                            | number : "1.0-0"
                                                    }}
                                                    <span
                                                        class="price-currency-symbol"
                                                        >đ</span
                                                    >
                                                </bdi>
                                            </span>
                                        </td>
                                    </tr>

                                    <!-- Voucher giảm giá -->
                                    <tr
                                        class="cart-subtotal"
                                        *ngIf="listVoucher.length > 0"
                                    >
                                        <th>Voucher giảm giá</th>
                                        <td style="text-align: right">
                                            <span
                                                class="price-amount amount"
                                                style="color: red"
                                            >
                                                <bdi
                                                    >{{
                                                        listVoucher[0]
                                                            .voucherAmount
                                                            | number : "1.0-0"
                                                    }}
                                                    <span
                                                        class="price-currency-symbol"
                                                        >đ</span
                                                    >
                                                </bdi>
                                            </span>
                                        </td>
                                    </tr>

                                    <!-- Tổng cộng -->
                                    <tr class="order-total">
                                        <th>Tổng</th>
                                        <td style="text-align: right">
                                            <strong>
                                                <span
                                                    class="price-amount amount"
                                                >
                                                    <bdi>
                                                        {{
                                                            calculateTotalVV()
                                                                | number
                                                                    : "1.0-0"
                                                        }}
                                                        <span
                                                            class="price-currency-symbol"
                                                            >đ</span
                                                        >
                                                    </bdi>
                                                </span>
                                            </strong>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>

                            <p class="payment__sidebar-desc">
                                Nếu không có phương thức thanh toán nào khả
                                dụng. Vui lòng liên hệ với chúng tôi nếu bạn cần
                                hỗ trợ hoặc muốn sắp xếp phương thức thanh toán
                                thay thế.
                            </p>
                            <button
                                class="btn-order-create"
                                type="submit"
                                [disabled]="isSubmitting"
                            >
                                {{ isSubmittingText }}
                            </button>
                            <p class="payment__sidebar-policy">
                                Thông tin cá nhân của bạn sẽ được sử dụng để xử
                                lý đơn hàng, tăng trải nghiệm sử dụng website,
                                và cho các mục đích cụ thể khác đã được mô tả
                                trong
                                <a href="#"> chính sách riêng tư. </a>
                            </p>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
